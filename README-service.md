# Win Screenshot App - バックグラウンドサービス機能

## 概要

Win Screenshot Appは、3つの異なる起動モードをサポートするバックグラウンドサービス機能を提供します。

## 起動モード

### 1. バックグラウンドモード（デフォルト）
- シェルから完全に分離して動作
- コンソールウィンドウは非表示
- システムトレイからのみ操作可能
- シェルを閉じてもアプリケーションは継続動作

### 2. 開発モード
- コンソール出力が有効
- デバッグログが表示
- キーボードショートカットが利用可能
- 開発・デバッグ用

### 3. フォアグラウンドモード
- コンソールが表示される
- 親プロセスとの接続を維持
- ウィンドウを閉じるとアプリケーションも終了

## 起動方法

### バッチファイルを使用（推奨）

```bash
# バックグラウンドモード（デフォルト）
start.bat

# 開発モード
start-dev.bat

# フォアグラウンドモード
start-foreground.bat
```

### npmコマンドを使用

```bash
# バックグラウンドモード
npm start

# 開発モード
npm run start-dev

# フォアグラウンドモード
npm run start-foreground
```

### 直接実行

```bash
# ビルド
npm run build

# バックグラウンドモード
npx electron dist/main.js --background
# または引数なし
npx electron dist/main.js

# 開発モード
npx electron dist/main.js --dev

# フォアグラウンドモード
npx electron dist/main.js --foreground
```

## コマンドラインオプション

| オプション | 短縮形 | 説明 |
|-----------|--------|------|
| `--background` | `-b` | バックグラウンドモードで起動 |
| `--dev` | `-d` | 開発モードで起動 |
| `--foreground` | `-f` | フォアグラウンドモードで起動 |
| `--help` | `-h` | ヘルプメッセージを表示 |

## 開発モードのキーボードショートカット

| キー | 動作 |
|------|------|
| `Ctrl+C` | アプリケーション終了 |
| `Ctrl+D` | デバッグ情報表示 |
| `h` | ヘルプ表示 |
| `q` | アプリケーション終了 |

## プロセス管理

### PIDファイル
- バックグラウンドモードでは、PIDファイルが作成されます
- 場所: `%TEMP%\win-screenshot-app.pid`
- 重複起動を防止します

### 自動再起動
- クラッシュ時に自動的に再起動を試行します
- 起動直後（60秒以内）のクラッシュでは再起動しません
- メモリ使用量が多すぎる場合は再起動しません
- 開発モードでは自動再起動は無効です

## ログ記録

### ログファイル
- すべてのモードでログファイルに記録されます
- システムトレイから「ログを表示」でアクセス可能

### ログレベル
- バックグラウンドモード: `info`
- 開発モード: `debug`
- フォアグラウンドモード: `info`

## トラブルシューティング

### アプリケーションが起動しない
1. 既に実行中でないか確認
2. PIDファイルを削除: `%TEMP%\win-screenshot-app.pid`
3. ログファイルでエラーを確認

### シェルを閉じるとアプリケーションも終了する
- バックグラウンドモードで起動していることを確認
- `start.bat` または `npm start` を使用

### 開発モードでキーボードショートカットが効かない
- コンソールウィンドウがアクティブになっていることを確認
- TTY環境で実行していることを確認

## システム要件

- Windows 10/11
- Node.js 16以上
- Electron 28以上

## セキュリティ

- PIDファイルは適切な権限で作成されます
- プロセス終了時に自動的にクリーンアップされます
- 不正なプロセス操作を防止します